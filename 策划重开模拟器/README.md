# 策划重开模拟器

## 0.高概念以及核心目标
玩家将通过选择天赋以及技能点，体验不同的策划生涯，品各式牛马人生。

**核心目标**：干得久不一定能成人上人，干的牛逼才是。

## 1.游戏流程

玩家在游戏中将经历4个阶段：

- 天赋选择
- 属性分配
- 事件分发
- 结束评价

### 1.1 天赋选择
玩家在开始游戏后，将进入此阶段：
游戏将在天赋池中随机抽取10个天赋，并供玩家选择，如无**特殊情况**，玩家此时**必须选择3个天赋**，才能进入下一个阶段

- 天赋的抽取规则
  - 天赋将按照稀有度被赋予权重
  - 天赋将按分次抽取，即从第一个分次抽到最后一个。
  - 在抽取天赋时，将排除与**已有抽取天赋冲突的天赋**
  

### 1.2 属性选择
在此阶段，玩家将自由分配10个属性点，玩家将在以下几个属性中分配。

### 1.3 事件分发
游戏中的事件将以`月`为单位进行分发。
分发将以以下几个阶段进行分发：
- 获取当前`月`的事件池
- 检索当前事件池的事件，并根据`属性条件`和`天赋条件`进行筛选，不符合的事件将去掉，并成为新的事件池。
- 判断权重，并根据权重随机选择出一个事件。
- 结算事件效果：属性变化 或 获得天赋
- 如果该事件有后续事件，判断该条件，如果条件符合，下个月一定进入该事件。
- 

结束判断：1.如果随机到某个

### 1.4 结束评价

结束后 游戏将根据玩家的各项指标对其策划生涯进行评价
分为以下评价：
- 白色普通
- 绿色还行
- 蓝色优秀
- 紫色卓越
- 橙色传说
- 红色逆天

评价指标除开传统各项数值以外，还将加入时间这一要素。
即对玩家在游戏行业的存活时间进行评价。


## 2. luban有关的笔记
### 2.1 工作流

游戏基础逻辑 -> 测试逻辑 ->  逻辑拆分出配置数据 -> 建表 -> json -> 逻辑接入 -> 完成

### 2.2 luban目前情况

1. 对于独立游戏项目来说其实还是比较重度了，比如客户端服务端的分组、校验相关的内容对于独立游戏来说根本不重要。
2. 对于GODOT的支持来说其实不是很多，比如编辑器拓展以及导出gds对应的资源相关的功能都无。（不过说实话做起来也很简单）

目前在godot中支持对项目管理友好的序列化资源`.tres`，后续考虑excel->`.tres`.

## 3.godot 相关的笔记
### 3.1 公式解析

在数据配置阶段。


godot提供了一个类`Expression`专门对`string`类型的公式表达式进行解析。

>表达式可以由任何算术运算、内置数学函数调用、传递实例的方法调用或内置类型构造调用组成。一个使用内置数学函数的示例表达式文本可以是 sqrt(pow(3, 2) + pow(4, 2))。

在下面的示例中，我们使用 LineEdit 节点来编写表达式并显示结果。

```gdscript

var expression = Expression.new()

func _ready():
	$LineEdit.text_submitted.connect(self._on_text_submitted)

func _on_text_submitted(command):
	var error = expression.parse(command)
	if error != OK:
		print(expression.get_error_text())
		return
	var result = expression.execute()
	if not expression.has_execute_failed():
		$LineEdit.text = str(result)

```

希望支持的公式效果有
- 条件
  - 大小运算
    - 属性名>
    - 属性名<
    - 属性名==
  - 包含运算
    - EVT?[数组]
    - TLT？[数组]

但是后面发现`Expression`这个库对于条件运算的支持很差。最后还是走向用`RegEx`即正则表达式的解法。

### 3.2 有关于项目组织的技巧

这次的项目结构中，我把luban以及readme等相应文件加入了编辑器可读取的工程文件中，这直接导致了每次我编辑readme文件的时候，编辑器总提示我有更新是否重新加载
这个虽然能通过增加忽略文件格式解决，但始终还是麻烦，可能还有其他问题。
建议以后以：
Project
| Game(游戏编辑器主要文件)
| Tool
| Excels
| Readme.md
这样的格式进行储存。
